<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ECOKISAN</title>
    <link rel="icon" type="image/png" href="assets/applogo.png">
<style>/* CSS Variables - New Palette */
:root {
    --primary-green: #2e7d32;
    --dark-green: #1b5e20;
    --light-green: #e8f5e9;
    --earthy-brown: #795548;
    --text-color: #333;
    --bg-color-light: #f7f7f7;
    --bg-color-gradient: linear-gradient(to bottom, #c8e6c9, #e8f5e9);
    --card-bg: #fff;
    --shadow-light: 0 4px 8px rgba(0, 0, 0, 0.1);
    --shadow-medium: 0 6px 12px rgba(0, 0, 0, 0.15);
}

/* General Body and Layout */
body {
    font-family: Arial, sans-serif;
    background: var(--bg-color-gradient);
    color: var(--text-color);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    box-sizing: border-box;
}

/* New Layout for Main Content */
.main-content {
    max-width: 1400px;
    margin: 20px auto;
    padding: 0 20px;
}

.container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

/* Header and Navigation */
.header {
    width: 100%;
    background-color: var(--card-bg);
    box-shadow: var(--shadow-medium);
    position: sticky;
    top: 0;
    z-index: 1000;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-weight: bold;
    font-size: 1.8em;
    color: var(--primary-green);
    width: 100px;
    height: 100px;
    background-image: url('assets/applogo.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    text-indent: -9999px;
    overflow: hidden;
}

.nav-links {
    display: flex;
    gap: 20px;
    align-items: center;
}

.nav-links a {
    text-decoration: none;
    color: var(--text-color);
    font-weight: 500;
    padding: 10px 15px;
    transition: color 0.3s, background-color 0.3s;
    border-radius: 5px;
}

.nav-links a:hover {
    color: var(--card-bg);
    background-color: var(--primary-green);
}

.google-translate-container {
    display: flex;
    align-items: center;
}

#google_translate_element {
    margin-left: 20px;
}

.menu-toggle {
    display: none;
    font-size: 2em;
    cursor: pointer;
    color: var(--primary-green);
}

.title {
    text-align: center;
    width: 100%;
    font-size: 2.5em;
    font-weight: bold;
    color: var(--primary-green);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

/* Shared Card Styling */
.card {
    background-color: var(--card-bg);
    padding: 25px;
    border-radius: 20px;
    box-shadow: var(--shadow-medium);
    border: 1px solid #ddd;
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 45%;
}

.card-title {
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
    color: var(--dark-green);
}

/* Soil Viewer Specific Styles */
.map {
    width: 100%;
    height: 300px;
    border-radius: 10px;
    margin-bottom: 15px;
    border: 2px solid var(--primary-green);
}

.button {
    width: 100%;
    padding: 12px;
    margin-bottom: 8px;
    border-radius: 8px;
    background-color: var(--primary-green);
    color: var(--light-green);
    font-weight: bold;
    font-size: 16px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.button:hover {
    background-color: var(--dark-green);
}

.button:disabled {
    background-color: #aaa;
    cursor: not-allowed;
}

.spinner-container {
    margin-top: 20px;
    text-align: center;
}

/* 4x3 Grid for Soil Data */
.soil-data-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Corrected for better responsiveness */
    gap: 15px;
}

.grid-item {
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    box-shadow: var(--shadow-light);
    background: var(--light-green);
    color: var(--text-color);
    transition: transform 0.2s;
}

.grid-item:hover {
    transform: translateY(-3px);
}

.property-name {
    font-weight: 600;
    margin-top: 5px;
    font-size: 14px;
    text-align: center;
    color: var(--dark-green);
}

.property-value {
    margin-top: 2px;
    font-size: 16px;
    font-weight: bold;
    color: var(--earthy-brown);
}

.icon {
    font-size: 30px;
    color: var(--primary-green);
}

/* Weather Dashboard Specific Styles */
.search-bar {
    display: none;
}

.current-weather-info .location {
    font-size: 1.5em;
    margin-bottom: 5px;
    color: var(--primary-green);
}

#current-weather {
    display: flex;
    justify-content: space-around;
    align-items: center;
    flex-wrap: wrap;
    text-align: center;
    color: var(--text-color);
}

.current-weather-icon i {
    font-size: 5em;
    color: var(--primary-green);
}

.temperature {
    font-size: 3em;
    font-weight: bold;
    color: var(--earthy-brown);
    margin: 0;
}

.current-details {
    display: flex;
    flex-direction: column;
    gap: 10px;
    text-align: left;
}

.current-details p {
    margin: 0;
    display: flex;
    align-items: center;
    font-size: 1em;
}

.current-details i {
    margin-right: 10px;
    color: var(--primary-green);
}

#hourly-forecast {
    display: flex;
    overflow-x: auto;
    gap: 15px;
    padding-bottom: 10px;
    white-space: nowrap;
    justify-content: flex-start;
}

.hourly-card {
    background: var(--light-green);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    box-shadow: var(--shadow-light);
    transition: transform 0.3s ease;
    border: 1px solid var(--primary-green);
    min-width: 120px;
    color: var(--text-color);
}

.hourly-card:hover {
    transform: translateY(-5px);
    background: #dff0d8;
}

.hourly-card .hourly-icon i {
    font-size: 2.5em;
    color: var(--primary-green);
}

.hourly-card .temp {
    font-size: 1.5em;
    font-weight: bold;
    margin: 10px 0;
    color: var(--earthy-brown);
}

/* Responsive Design */
@media (max-width: 992px) {
    .card {
        min-width: 100%;
    }
}

@media (max-width: 768px) {
    .nav-links {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        background-color: var(--card-bg);
        box-shadow: var(--shadow-light);
    }

    .nav-links.active {
        display: flex;
    }

    .menu-toggle {
        display: block;
    }

    .header {
        flex-wrap: wrap; /* Added to ensure elements wrap correctly */
        align-items: center; /* Ensures vertical alignment */
    }

    .header .logo,
    .header .menu-toggle {
        order: 1; /* Sets the order for a better mobile layout */
    }

    .header .google-translate-container {
        order: 2; /* Sets the order for a better mobile layout */
        margin-top: 0; /* Removed unnecessary margin */
        position: static;
        margin-left: auto; /* Aligns to the right */
    }

    .nav-links {
        order: 3;
        width: 100%;
        margin-top: 10px; /* Added separation from top elements */
    }
}</style>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
Â  Â  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
Â <header class="header">
        <div class="logo" style="width: 100px; height: 100px; background-image: url('assets/applogo.png'); background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
   <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="precropadvisory.html">Pre Crop Advisory</a>
            <a href="MarketInsights.html">Market Insights</a>
            <a href="Incropmanagement.html">In crop management</a>
            <a href="Disease_detection.html">Leaf Image Detection</a>
            <a href="chatbot.html">Chatbot</a>
            <a href="YieldandProfitEstimation.html">Yield and Profit Estimation</a>
            <a href="Aboutus.html">About Us</a>
            <div class="google-translate-container">
                <div id="google_translate_element"></div>
            </div>
        </div>
        <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
    </header>

<div class="main-content">
Â  Â  <h1 class="title">ğŸŒ± Green Dashboard</h1>
Â  Â  
Â  Â  <div class="container">
Â  Â  Â  Â  <div class="card weather-card">
Â  Â  Â  Â  Â  Â  <h2 class="card-title">â˜ï¸ Weather Dashboard</h2>
Â  Â  Â  Â  Â  Â  <div id="current-weather"></div>
Â  Â  Â  Â  Â  Â  <div class="weather-card hourly-forecast-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="card-title">Hourly Forecast</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="hourly-forecast"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card soil-card">
Â  Â  Â  Â  Â  Â  <h2 class="card-title">ğŸ—ºï¸ Soil Properties Viewer</h2>
Â  Â  Â  Â  Â  Â  <div id="map" class="map"></div>
Â  Â  Â  Â  Â  Â  <button id="live-location-btn" class="button">Use Live Location</button>
Â  Â  Â  Â  Â  Â  <button id="fetch-data-btn" class="button">Fetch Soil Data & Weather</button>
Â  Â  Â  Â  Â  Â  <div id="loading-spinner" class="spinner-container" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-spinner fa-spin fa-2x"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="soil-data-container" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">Soil Properties:</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="soil-data-grid" class="soil-data-grid"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script type="text/javascript">
Â  Â  function googleTranslateElementInit() {
Â  Â  Â  Â  const lang = localStorage.getItem('selectedLanguage');
Â  Â  Â  Â  if (lang) {
Â  Â  Â  Â  Â  Â  document.cookie = `googtrans=/en/${lang};path=/`;
Â  Â  Â  Â  }
Â  Â  Â  Â  new google.translate.TranslateElement(
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  pageLanguage: 'en',
Â  Â  Â  Â  Â  Â  Â  Â  includedLanguages: 'en,as,bn,gu,hi,kn,ml,mr,ne,or,pa,ta,te,ur',
Â  Â  Â  Â  Â  Â  Â  Â  layout: google.translate.TranslateElement.InlineLayout.SIMPLE
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  'google_translate_element'
Â  Â  Â  Â  );
Â  Â  }
Â  Â  window.onload = googleTranslateElementInit;

Â  Â  setTimeout(() => {
Â  Â  Â  Â  const selector = document.querySelector('.goog-te-combo');
Â  Â  Â  Â  if (selector) {
Â  Â  Â  Â  Â  Â  selector.addEventListener('change', (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  const selectedLang = event.target.value;
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('selectedLanguage', selectedLang);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }, 1000);
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
Â  Â  function toggleMenu() {
Â  Â  Â  Â  const navLinks = document.querySelector('.nav-links');
Â  Â  Â  Â  navLinks.classList.toggle('active');
Â  Â  }

Â  Â 
</script>

Â  Â  <script>
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  // Â  Â  Â  Â SOIL PROPERTIES VIEWER LOGIC
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  const mapElement = document.getElementById('map');
Â  Â  Â  Â  const liveLocationBtn = document.getElementById('live-location-btn');
Â  Â  Â  Â  const fetchDataBtn = document.getElementById('fetch-data-btn');
Â  Â  Â  Â  const loadingSpinner = document.getElementById('loading-spinner');
Â  Â  Â  Â  const soilDataContainer = document.getElementById('soil-data-container');
Â  Â  Â  Â  const soilDataGrid = document.getElementById('soil-data-grid');
Â  Â  Â  Â  const currentWeatherDiv = document.getElementById('current-weather');
Â  Â  Â  Â  const hourlyForecastDiv = document.getElementById('hourly-forecast');
Â  Â  Â  Â  
Â  Â  Â  Â  let markerLocation = null;
Â  Â  Â  Â  let map, marker;
Â  Â  Â  Â  
Â  Â  Â  Â  function initializeMap() {
Â  Â  Â  Â  Â  Â  map = L.map('map').setView([20.5937, 78.9629], 5);
Â  Â  Â  Â  Â  Â  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
Â  Â  Â  Â  Â  Â  Â  Â  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
Â  Â  Â  Â  Â  Â  }).addTo(map);
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  map.on('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  setMarkerLocation(e.latlng);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function setMarkerLocation(coords) {
Â  Â  Â  Â  Â  Â  markerLocation = coords;
Â  Â  Â  Â  Â  Â  if (marker) {
Â  Â  Â  Â  Â  Â  Â  Â  marker.setLatLng(coords);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  marker = L.marker(coords).addTo(map);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  map.setView(coords, 10);
Â  Â  Â  Â  Â  Â  console.log(`Marker set at: ${coords.lat}, ${coords.lng}`);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  const propertyDetails = {
Â  Â  Â  Â  Â  Â  B: { name: 'Boron', icon: 'fas fa-seedling' },
Â  Â  Â  Â  Â  Â  Cu: { name: 'Copper', icon: 'fas fa-flask' },
Â  Â  Â  Â  Â  Â  EC: { name: 'Electrical Conductivity', icon: 'fas fa-bolt' },
Â  Â  Â  Â  Â  Â  Fe: { name: 'Iron', icon: 'fas fa-hammer' },
Â  Â  Â  Â  Â  Â  K: { name: 'Potassium', icon: 'fas fa-vial' },
Â  Â  Â  Â  Â  Â  Mn: { name: 'Manganese', icon: 'fas fa-atom' },
Â  Â  Â  Â  Â  Â  N: { name: 'Nitrogen', icon: 'fas fa-leaf' },
Â  Â  Â  Â  Â  Â  OC: { name: 'Organic Carbon', icon: 'fas fa-leaf' },
Â  Â  Â  Â  Â  Â  P: { name: 'Phosphorus', icon: 'fas fa-circle-notch' },
Â  Â  Â  Â  Â  Â  pH: { name: 'pH', icon: 'fas fa-tint' },
Â  Â  Â  Â  Â  Â  S: { name: 'Sulfur', icon: 'fas fa-burn' },
Â  Â  Â  Â  Â  Â  Zn: { name: 'Zinc', icon: 'fas fa-square-z' },
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  function displaySoilData(data) {
Â  Â  Â  Â  Â  Â  soilDataGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â  for (const [key, value] of Object.entries(data)) {
Â  Â  Â  Â  Â  Â  Â  Â  const details = propertyDetails[key] || { name: key, icon: 'fas fa-circle' };
Â  Â  Â  Â  Â  Â  Â  Â  const gridItem = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  gridItem.className = 'grid-item';
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  gridItem.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${details.icon} icon"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="property-name">${details.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="property-value">${typeof value === 'number' ? value.toFixed(2) : value || 'N/A'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  soilDataGrid.appendChild(gridItem);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  soilDataContainer.style.display = 'block';
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function showAlert(message) {
Â  Â  Â  Â  Â  Â  alert(message);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function showLoading(isLoading) {
Â  Â  Â  Â  Â  Â  loadingSpinner.style.display = isLoading ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  fetchDataBtn.disabled = isLoading;
Â  Â  Â  Â  Â  Â  liveLocationBtn.disabled = isLoading;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  async function fetchLiveLocation() {
Â  Â  Â  Â  Â  Â  showLoading(true);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (!navigator.geolocation) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Geolocation is not supported by your browser');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const position = await new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(resolve, reject, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enableHighAccuracy: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeout: 5000,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maximumAge: 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const coords = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lat: position.coords.latitude,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lng: position.coords.longitude
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  setMarkerLocation(coords);
Â  Â  Â  Â  Â  Â  Â  Â  fetchWeatherData(coords.lat, coords.lng, 'Your Location');
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('Error: Failed to get location - ' + error.message);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  showLoading(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  async function fetchSoilAndWeatherData() {
Â  Â  Â  Â  Â  Â  if (!markerLocation) {
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('Please select a location on the map first.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  showLoading(true);
Â  Â  Â  Â  Â  Â  soilDataContainer.style.display = 'none';
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Fetch Soil Data
Â  Â  Â  Â  Â  Â  Â  Â  const soilUrl = `https://rest-sisindia.isric.org/sisindia/v1.0/properties/query/gridded?lat=${markerLocation.lat}&lon=${markerLocation.lng}`;
Â  Â  Â  Â  Â  Â  Â  Â  const soilResponse = await fetch(soilUrl);
Â  Â  Â  Â  Â  Â  Â  Â  if (!soilResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! Status: ${soilResponse.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const soilData = await soilResponse.json();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (!soilData.features?.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('No soil data found for this location.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const properties = soilData.features[0].properties.soil_properties;
Â  Â  Â  Â  Â  Â  Â  Â  displaySoilData(properties);
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Fetch Weather Data using the same coordinates
Â  Â  Â  Â  Â  Â  Â  Â  fetchWeatherData(markerLocation.lat, markerLocation.lng);
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('Error: Failed to fetch data - ' + error.message);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  showLoading(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  // Â  Â  Â  Â WEATHER DASHBOARD LOGIC
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  async function fetchWeatherData(lat, lon, locationName = 'Selected Location') {
Â  Â  Â  Â  Â  Â  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m,apparent_temperature,surface_pressure,uv_index&hourly=temperature_2m,weather_code&forecast_days=1&timezone=auto`;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  renderCurrentWeather(data.current, data.timezone, locationName);
Â  Â  Â  Â  Â  Â  Â  Â  renderHourlyForecast(data.hourly, data.timezone);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching weather data:', error);
Â  Â  Â  Â  Â  Â  Â  Â  currentWeatherDiv.innerHTML = '<p>Failed to load weather data.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  hourlyForecastDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function renderCurrentWeather(current, timezone, locationName) {
Â  Â  Â  Â  Â  Â  const weatherCode = current.weather_code;
Â  Â  Â  Â  Â  Â  const { icon, description } = getWeatherIcon(weatherCode);
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  currentWeatherDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="current-weather-icon"><i class="fa-solid ${icon}"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="current-weather-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="location">${locationName}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="temperature">${Math.round(current.temperature_2m)}Â°C</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="description">${description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="feels-like">Feels like: ${Math.round(current.apparent_temperature)}Â°C</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="current-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><i class="fa-solid fa-wind"></i>Wind: ${current.wind_speed_10m} km/h</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><i class="fa-solid fa-droplet"></i>Humidity: ${current.relative_humidity_2m}%</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><i class="fa-solid fa-gauge"></i>Pressure: ${current.surface_pressure} hPa</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><i class="fa-solid fa-sun"></i>UV Index: ${current.uv_index}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><i class="fa-solid fa-clock"></i>Time: ${new Date().toLocaleTimeString('en-US', { timeZone: timezone, hour: '2-digit', minute: '2-digit' })}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function renderHourlyForecast(hourly, timezone) {
Â  Â  Â  Â  Â  Â  hourlyForecastDiv.innerHTML = ''; // Clear previous content
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const currentHour = new Date().getHours();
Â  Â  Â  Â  Â  Â  const today = new Date().toLocaleDateString();
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const startIndex = hourly.time.findIndex(timeStr => {
Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(timeStr);
Â  Â  Â  Â  Â  Â  Â  Â  return date.getHours() === currentHour && date.toLocaleDateString() === today;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (startIndex === -1) {
Â  Â  Â  Â  Â  Â  Â  Â  hourlyForecastDiv.innerHTML = '<p>No hourly data available for the current time.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  for (let i = startIndex; i < startIndex + 8 && i < hourly.time.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const time = new Date(hourly.time[i]);
Â  Â  Â  Â  Â  Â  Â  Â  const temp = Math.round(hourly.temperature_2m[i]);
Â  Â  Â  Â  Â  Â  Â  Â  const weatherCode = hourly.weather_code[i];
Â  Â  Â  Â  Â  Â  Â  Â  const { icon, description } = getWeatherIcon(weatherCode);
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'hourly-card';
Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hour">${time.getHours()}:00</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hourly-icon"><i class="fa-solid ${icon}"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="temp">${temp}Â°C</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="description">${description}</div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  hourlyForecastDiv.appendChild(card);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function getWeatherIcon(code) {
Â  Â  Â  Â  Â  Â  const codes = {
Â  Â  Â  Â  Â  Â  Â  Â  0: { icon: 'fa-sun', description: 'Clear sky' },
Â  Â  Â  Â  Â  Â  Â  Â  1: { icon: 'fa-cloud-sun', description: 'Mainly clear' },
Â  Â  Â  Â  Â  Â  Â  Â  2: { icon: 'fa-cloud', description: 'Partly cloudy' },
Â  Â  Â  Â  Â  Â  Â  Â  3: { icon: 'fa-cloud', description: 'Overcast' },
Â  Â  Â  Â  Â  Â  Â  Â  45: { icon: 'fa-smog', description: 'Fog' },
Â  Â  Â  Â  Â  Â  Â  Â  48: { icon: 'fa-smog', description: 'Depositing rime fog' },
Â  Â  Â  Â  Â  Â  Â  Â  51: { icon: 'fa-cloud-drizzle', description: 'Drizzle' },
Â  Â  Â  Â  Â  Â  Â  Â  53: { icon: 'fa-cloud-showers-heavy', description: 'Moderate Drizzle' },
Â  Â  Â  Â  Â  Â  Â  Â  55: { icon: 'fa-cloud-showers-heavy', description: 'Dense Drizzle' },
Â  Â  Â  Â  Â  Â  Â  Â  56: { icon: 'fa-cloud-sleet', description: 'Freezing Drizzle' },
Â  Â  Â  Â  Â  Â  Â  Â  57: { icon: 'fa-cloud-sleet', description: 'Dense Freezing Drizzle' },
Â  Â  Â  Â  Â  Â  Â  Â  61: { icon: 'fa-cloud-rain', description: 'Slight Rain' },
Â  Â  Â  Â  Â  Â  Â  Â  63: { icon: 'fa-cloud-rain', description: 'Moderate Rain' },
Â  Â  Â  Â  Â  Â  Â  Â  65: { icon: 'fa-cloud-showers-heavy', description: 'Heavy Rain' },
Â  Â  Â  Â  Â  Â  Â  Â  66: { icon: 'fa-cloud-sleet', description: 'Freezing Rain' },
Â  Â  Â  Â  Â  Â  Â  Â  67: { icon: 'fa-cloud-sleet', description: 'Heavy Freezing Rain' },
Â  Â  Â  Â  Â  Â  Â  Â  71: { icon: 'fa-snowflake', description: 'Slight Snow' },
Â  Â  Â  Â  Â  Â  Â  Â  73: { icon: 'fa-snowflake', description: 'Moderate Snow' },
Â  Â  Â  Â  Â  Â  Â  Â  75: { icon: 'fa-snowflake', description: 'Heavy Snow' },
Â  Â  Â  Â  Â  Â  Â  Â  77: { icon: 'fa-snowflake', description: 'Snow Grains' },
Â  Â  Â  Â  Â  Â  Â  Â  80: { icon: 'fa-cloud-showers-heavy', description: 'Slight Rain Showers' },
Â  Â  Â  Â  Â  Â  Â  Â  81: { icon: 'fa-cloud-showers-heavy', description: 'Moderate Rain Showers' },
Â  Â  Â  Â  Â  Â  Â  Â  82: { icon: 'fa-cloud-showers-heavy', description: 'Violent Rain Showers' },
Â  Â  Â  Â  Â  Â  Â  Â  85: { icon: 'fa-snowflake', description: 'Slight Snow Showers' },
Â  Â  Â  Â  Â  Â  Â  Â  86: { icon: 'fa-snowflake', description: 'Heavy Snow Showers' },
Â  Â  Â  Â  Â  Â  Â  Â  95: { icon: 'fa-poo-storm', description: 'Thunderstorm' },
Â  Â  Â  Â  Â  Â  Â  Â  96: { icon: 'fa-poo-storm', description: 'Thunderstorm with hail' },
Â  Â  Â  Â  Â  Â  Â  Â  99: { icon: 'fa-poo-storm', description: 'Thunderstorm with heavy hail' }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  return codes[code] || { icon: 'fa-question-circle', description: 'Unknown' };
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  // Â  Â  Â  Â INITIALIZATION
Â  Â  Â  Â  // =========================================
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  initializeMap();
Â  Â  Â  Â  Â  Â  liveLocationBtn.addEventListener('click', fetchLiveLocation);
Â  Â  Â  Â  Â  Â  fetchDataBtn.addEventListener('click', fetchSoilAndWeatherData);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Initial load using user's location or a default one
Â  Â  Â  Â  Â  Â  if (navigator.geolocation) {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(position => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lat = position.coords.latitude;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lon = position.coords.longitude;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setMarkerLocation({ lat, lng: lon });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchWeatherData(lat, lon, 'Your Location');
Â  Â  Â  Â  Â  Â  Â  Â  }, () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Fallback to a default location if geolocation is denied
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const defaultCoords = { lat: 20.5937, lng: 78.9629 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setMarkerLocation(defaultCoords);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchWeatherData(defaultCoords.lat, defaultCoords.lng, 'India');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Fallback for browsers without geolocation
Â  Â  Â  Â  Â  Â  Â  Â  const defaultCoords = { lat: 20.5937, lng: 78.9629 };
Â  Â  Â  Â  Â  Â  Â  Â  setMarkerLocation(defaultCoords);
Â  Â  Â  Â  Â  Â  Â  Â  fetchWeatherData(defaultCoords.lat, defaultCoords.lng, 'India');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>